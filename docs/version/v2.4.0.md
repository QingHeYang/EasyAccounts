# v2.4.0 版本更新 (含登录功能)

**更新日期**：2025-02-07  
**更新视频**：[【开源记账软件 EasyAccounts v2.4.0 新版本说明】](https://www.bilibili.com/video/BV1P1NPe4Er8/)

## 重要特性

1. **登录功能**：增加用户认证功能，可通过 compose 配置开启/关闭，默认关闭
2. **统计功能重构**：
   - 原财务分析页面作废
   - 新增按分类统计汇总
   - 支持单项分类汇总
   - 可按月查看单项分类明细
3. **分类管理优化**：新增"不参与统计"选项，灵活控制统计范围

## 新增功能

1. 生成 Excel 报表时增加同步等待反馈
2. WebHook 逻辑判断优化
3. 界面重构：
   - 总览界面重新设计，增加当年月度概览
   - 账户详情移至顶部
   - "记一笔"按钮移至明细页面底部，支持拖动
   - 筛选入口移至原"记一笔"位置
4. 筛选功能增强：默认开启备注搜索

## Bug 修复

- 修复主页请求 500 错误（跨年后请求错误）
- 修复 webhook 发送邮件时多收件人可能失败的问题
- 生成历史月份 Excel 时，报表中账户金额可以追溯

## 技术特性

1. **外部数据库支持**：支持连接外部 MySQL 数据库，通过 compose 配置控制
2. **前端框架升级**：
   - Vue 2 → Vue 3
   - Vant 2 → Vant 4

## 配置变更

### Server 环境变量新增

```yaml
server:
    environment:
      - ENABLE_LOGIN=true         # 是否启用登录功能，默认true 
      - EXPIRED_TIME=30           # 登录过期时间，默认30分钟
      
      # 外部数据库配置（可选）
      #- MYSQL_HOST=192.168.1.100  # 外部数据库地址
      #- MYSQL_PORT=3306           # 外部数据库端口
      #- MYSQL_USERNAME=root       # 外部数据库用户名
```

### Server 卷映射新增

```yaml
server:
    volumes:
      - ./Server/auth:/Ledger/auth  # 登录认证文件目录，必须映射
```

## 升级注意事项

1. 登录功能默认关闭，需要手动开启
2. 如果启用登录功能，首次登录会生成默认账号密码
3. 认证文件存储在 `Server/auth/secret.key`，删除此文件可重置密码
4. 升级前请备份数据库